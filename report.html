<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
</head>
<body>
    <div id="report-container"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyARzeyulL-4c_ATw7NcUP-gsUh2-qE3fNU",
            authDomain: "sigma-app-e9397.firebaseapp.com",
            projectId: "sigma-app-e9397",
            storageBucket: "sigma-app-e9397.firebasestorage.app",
            messagingSenderId: "561606435145",
            appId: "1:561606435145:web:c68e3629ce50215f177a98",
            measurementId: "G-1KG5C55LEB"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function loadReport() {
            try {
                const params = new URLSearchParams(window.location.search);
                const rid = params.get('rid');

                if (!rid) {
                    document.getElementById('report-container').innerHTML = '<p>No report ID provided</p>';
                    return;
                }

                const snapshot = await db.collectionGroup('reports')
                    .where('reportId', '==', rid)
                    .limit(1)
                    .get();

                if (snapshot.empty) {
                    document.getElementById('report-container').innerHTML = '<p>Report not found</p>';
                    return;
                }

                const report = snapshot.docs[0].data();
                document.getElementById('report-container').innerHTML = report.html;

            } catch (err) {
                console.error('Error:', err);
                document.getElementById('report-container').innerHTML = `<p>Error: ${err.message}</p>`;
            }
        }

        loadReport();
    </script>
</body>
</html>